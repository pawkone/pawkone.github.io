<!DOCTYPE html>
<html lang="en-us">
  <head>
    <style>
      body {
        background: #000;
        color: #fff;
        overflow: hidden;
        display: flex;
        align-items: center;
        justify-content: center;
        height: 100vh;
        margin: 0;
        font-family: monospace;
        image-rendering: pixelated;
        -ms-interpolation-mode: nearest-neighbor;
      }
      #loading {
        position: absolute;
        z-index: 1;
        align-items: center;
        justify-content: center;
        font-size: 2em;
      }
      canvas {
        height: 100vh;
      }
    </style>
  </head>
  <body>
    <div id="loading">Loading 0%</div>
    <canvas id="canvas"></canvas>
    <script type="text/javascript">
      const CHANGE_ASPECT_RATIO = true;
      var canvasElement = document.getElementById("canvas");
      const loading = document.getElementById('loading');
      const canvas = canvasElement;
      (() => {
        const progressMap = new Map();
        const upd = () => {
          let loaded=0, total=0;
          for (const v of progressMap.values()){ loaded+=v.loaded; total+=v.total; }
          if (total>0){
            loading.textContent = 'Loading ' + Math.max(0, Math.min(100, Math.floor(loaded/total*100))) + '%';
          }
        };
        const oOpen = XMLHttpRequest.prototype.open;
        const oSend = XMLHttpRequest.prototype.send;
        XMLHttpRequest.prototype.open = function(method, url){
          this._track = /(\.data$|runner\.data|\.wasm$)/.test(url);
          return oOpen.apply(this, arguments);
        };
        XMLHttpRequest.prototype.send = function(body){
          if (this._track){
            progressMap.set(this, {loaded:0,total:0});
            this.addEventListener('progress', e => {
              const r = progressMap.get(this);
              if (!r) return;
              if (e.lengthComputable) r.total = e.total;
              r.loaded = e.loaded || r.loaded;
              upd();
            });
            this.addEventListener('load', () => {
              const r = progressMap.get(this);
              if (r){
                if (!r.total && this.response && this.response.byteLength) r.total = this.response.byteLength;
                r.loaded = r.total || r.loaded;
              }
              upd(); progressMap.delete(this);
            });
            this.addEventListener('error', ()=>progressMap.delete(this));
            this.addEventListener('abort', ()=>progressMap.delete(this));
          }
          return oSend.apply(this, arguments);
        };
      })();
      var Module = {
        canvas: canvas,
        preRun: [],
        postRun: [() => { loading.style.display='none'; canvas.style.display='block'; }],
        setStatus: (txt) => {
          const m = txt && txt.match(/\((\d+)\/(\d+)\)/);
          if (m){
            const pct = Math.floor((+m[1]/+m[2])*100);
            loading.textContent = 'Loading ' + pct + '%';
          } else if (txt === 'Running...'){
            loading.style.display='none'; canvas.style.display='block';
          } else if (txt) {
            loading.textContent = txt;
          }
        },
        totalDependencies: 0,
        monitorRunDependencies: function(left){
          this.totalDependencies = Math.max(this.totalDependencies||0, left);
          const total = this.totalDependencies, done = total - left;
          if (total>0 && left>=0 && left<=total){
            const pct = Math.floor(done/total*100);
            loading.textContent = 'Loading ' + pct + '%';
          }
        }
      };
      var g_pWadLoadCallback=undefined;
      var g_pAddAsyncMethod=-1;
      function setAddAsyncMethod( asyncMethod )
      {g_pAddAsyncMethod=asyncMethod;}
      var g_pJSExceptionHandler = undefined;
      function setJSExceptionHandler( exceptionHandler )
      {if (typeof exceptionHandler=="function"){g_pJSExceptionHandler = exceptionHandler;}}
      function hasJSExceptionHandler()
      {return (g_pJSExceptionHandler!=undefined)&&(typeof g_pJSExceptionHandler=="function");}
      function doJSExceptionHandler(exceptionJSON)
      {if (typeof g_pJSExceptionHandler=="function"){var exception=JSON.parse(exceptionJSON);g_pJSExceptionHandler(exception);}}
      function manifestFiles()
      {return ["runner.data","runner.js","runner.wasm","audio-worklet.js","game.unx"].join( ";");}
    </script>
    <script async type="text/javascript" src="runner.js"></script>
  </body>
</html>
